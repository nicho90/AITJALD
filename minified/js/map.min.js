function channelStyle(e,t,a){var r={type:populationType,feature:e.feature},o={query:sparqlHTTPConnection.createSparqlQuery(r),display:"json",output:"json"};if(o.query)switch(populationType){case"main":case"entitled":if(t)switch(e.feature.properties.administrativeLvl){case"CityDistrict":e.feature.displayInformation={},sparqlHTTPConnection.sparqlPOSTRequest(o,function(t){if(0!=t.length)for(var r=0;r<t.length;r++){var o=t[r].year.value,l=parseInt(t[r].population.value),n=l/e.feature.properties.area;e.feature.displayInformation[o]={color:getDensitiyColor(n),population:l}}else console.log("no data available");if(void 0!=e.feature.displayInformation[selectedYear]){var l=e.feature.displayInformation[selectedYear].population;e.setStyle(densityStyle(l,e.feature.properties.area)),a&&e.setStyle(clickedStyle())}});break;case"District":case"City":if(t)e.feature.displayInformation={},sparqlHTTPConnection.sparqlPOSTRequest(o,function(t){if(0!=t.length){for(var r=0;r<t.length;r++){var o=t[r].year.value;void 0==e.feature.displayInformation[o]&&(e.feature.displayInformation[o]={population:0}),e.feature.displayInformation[o].population+=parseInt(t[r].population.value)}for(var l in e.feature.displayInformation){var n=e.feature.displayInformation[l].population/e.feature.properties.area;e.feature.displayInformation[l].color=getDensitiyColor(n)}}else console.log("no data available");var i=e.feature.displayInformation[selectedYear].population;e.setStyle(densityStyle(i,e.feature.properties.area)),a&&e.setStyle(clickedStyle())});else{var l=e.feature.displayInformation[selectedYear].population;e.setStyle(densityStyle(l,e.feature.properties.area))}break;default:console.log("error in channel Style")}else if(void 0!=e.feature.displayInformation[selectedYear]){var l=e.feature.displayInformation[selectedYear].population;e.setStyle(densityStyle(l,e.feature.properties.area)),a&&e.setStyle(clickedStyle())}break;case"female":case"male":case"gender":if(t)switch(e.feature.properties.administrativeLvl){case"CityDistrict":e.feature.displayInformation={},sparqlHTTPConnection.sparqlPOSTRequest(o,function(t){if(t.length>0)for(var r=0;r<t.length;r++)void 0==e.feature.displayInformation[t[r].year.value]&&(e.feature.displayInformation[t[r].year.value]={population:t[r].entitledPopulationValue.value}),e.feature.displayInformation[t[r].year.value][t[r].agegroup.value]={value:parseInt(t[r].value.value)},void 0==e.feature.displayInformation[t[r].year.value].all&&(e.feature.displayInformation[t[r].year.value].all={value:0}),e.feature.displayInformation[t[r].year.value].all.value+=parseInt(t[r].value.value);else console.log("No data Available for the feature "+e.feature.properties.name);if(void 0!=e.feature.displayInformation[selectedYear]){var o=e.feature.displayInformation[selectedYear].population;e.setStyle(procentStyle(o,e.feature.displayInformation[selectedYear][selectedAgeGroup].value)),a&&e.setStyle(clickedStyle())}});break;case"District":case"City":e.feature.displayInformation={},sparqlHTTPConnection.sparqlPOSTRequest(o,function(t){if(0!=t.length){for(var r=0;r<t.length;r++){var o=t[r].year.value;void 0==e.feature.displayInformation[o]&&(e.feature.displayInformation[o]={population:0,tmpPopulation:{}}),void 0==e.feature.displayInformation[o].tmpPopulation[t[r].feature.value]&&(e.feature.displayInformation[o].tmpPopulation[t[r].feature.value]=parseInt(t[r].entitledPopulationValue.value)),void 0==e.feature.displayInformation[o][t[r].agegroup.value]&&(e.feature.displayInformation[o][t[r].agegroup.value]={value:0}),e.feature.displayInformation[o][t[r].agegroup.value].value+=parseInt(t[r].value.value),void 0==e.feature.displayInformation[t[r].year.value].all&&(e.feature.displayInformation[t[r].year.value].all={value:0}),e.feature.displayInformation[t[r].year.value].all.value+=parseInt(t[r].value.value)}for(var l in e.feature.displayInformation){for(var n in e.feature.displayInformation[l].tmpPopulation)e.feature.displayInformation[l].population+=e.feature.displayInformation[l].tmpPopulation[n];delete e.feature.displayInformation[l].tmpPopulation}for(var l in e.feature.displayInformation){var i=e.feature.displayInformation[l].population/e.feature.properties.area;e.feature.displayInformation[l].color=getPercentColor(i)}}else console.log("no data available");if(void 0!=e.feature.displayInformation[selectedYear]){var p=e.feature.displayInformation[selectedYear].population;e.setStyle(procentStyle(p,e.feature.displayInformation[selectedYear][selectedAgeGroup].value)),a&&e.setStyle(clickedStyle())}});break;default:console.log("error in channel Style")}else if(void 0!=e.feature.displayInformation[selectedYear]){var l=e.feature.displayInformation[selectedYear].population;e.setStyle(procentStyle(l,e.feature.displayInformation[selectedYear][selectedAgeGroup].value)),a&&e.setStyle(clickedStyle())}}else console.error("The SPARQL query could not be created")}function densityStyle(e,t){var a=e/t;return{weight:2,opacity:.3,color:"black",fillOpacity:.7,fillColor:getDensitiyColor(a)}}function getDensitiyColor(e){return null!=e?e>1e3?"#8c2d04":e>500?"#cc4c02":e>200?"#ec7014":e>100?"#fe9929":e>50?"#fec44f":e>20?"#fee391":e>10?"#fff7bc":"#ffffe5":"#dddddd"}function procentStyle(e,t){var a=parseInt(t)/parseInt(e)*100;return{weight:2,opacity:.3,color:"black",fillOpacity:.7,fillColor:getPercentColor(a)}}function getPercentColor(e){return null!=e?e>75?"#8c2d04":e>50?"#cc4c02":e>25?"#ec7014":e>20?"#fe9929":e>15?"#fec44f":e>10?"#fee391":e>5?"#fff7bc":"#ffffe5":"#dddddd"}function clickedStyle(){return{color:"red",weight:3,opacity:1,fillOpacity:.9}}function getLegendHTML(){if("main"==populationType||"entitled"==populationType){for(var e,t,a=[0,10,20,50,100,200,500,1e3],r=[],o=0;o<a.length;o++)e=a[o],t=a[o+1],r.push('<li><span class="swatch" style="background:'+getDensitiyColor(e+1)+'"></span> '+e+(t?"&ndash;"+t:"+"))+"</li>";return"<span>"+language[getCookieObject().language].map.legend.title.mainPopulation+"</span><ul>"+r.join("")+"</ul>"}for(var e,t,a=[0,5,10,15,20,25,50,75],r=[],o=0;o<a.length;o++)e=a[o],t=a[o+1],r.push('<li><span class="swatch" style="background:'+getPercentColor(e+1)+'"></span> '+e+(t?"&ndash;"+t+" &#37;":" &#37; +"))+"</li>";return"<span>"+language[getCookieObject().language].map.legend.title.percentPopulation+"</span><ul>"+r.join("")+"</ul>"}function changeLegend(){$(".map-legend").empty(),$(".map-legend").html(getLegendHTML())}function changeStyleForAllLayers(e,t){for(var a=0;a<e.length;a++)for(var r in e[a]._layers)for(var o in e[a]._layers[r]._layers){for(var l=e[a]._layers[r]._layers[o].feature,n=!1,i=0;i<selectedFeatures.length;i++)selectedFeatures[i].feature==l&&(e[a]._layers[r].bringToFront(),n=!0);channelStyle(e[a]._layers[r]._layers[o],t,n)}}function createSliderControl(e,t){var a=L.Control.extend({options:{position:"bottomleft"},onAdd:function(){var e=L.DomUtil.create("div","leaflet-year-slider-control");return e.innerHTML='<div id="yearSlider"></div>',e}});e.addControl(new a),changeYearSliderControl(e,t)}function changeYearSliderControl(e,t){var a={type:"distinctPopulation",populationType:populationType},r={query:sparqlHTTPConnection.createSparqlQuery(a),display:"json",output:"json"},o=[];sparqlHTTPConnection.sparqlPOSTRequest(r,function(a){for(var r=0;r<a.length;r++)o.push(parseInt(a[r].year.value));$("#yearSlider").empty(),$("#yearSlider").slider({min:o[0],max:o[o.length-1],value:o[o.length-1],slide:function(e,a){selectedYear=a.value.toString(),changeStyleForAllLayers(t,!1)},start:function(){timeSliderMovement=!0,e.dragging.disable()},stop:function(){timeSliderMovement=!1,e.dragging.enable()}}).each(function(){for(var e=$(this).data()["ui-slider"].options,t=e.max-e.min,a=0;t>=a;a++){var r=$("<label>"+(a+e.min)+"</label>").css("left",a/t*100-3+"%");$("#yearSlider").append(r)}}),1==o.length?$("#yearSlider").css("width","10px"):$("#yearSlider").css("width","300px"),selectedYear=o[o.length-1]})}function setStyleForNoSelectedFeatures(){for(var e=0;e<selectedFeatures.length;e++)selectedFeatures[e].layer.setStyle(channelStyle(selectedFeatures[e].layer),!1)}function resize(){$("#map").css("height",$(window).height()-50)}var GEOSPARQLPREFIX="http://www.opengis.net/ont/geosparql#",GEOPREFIX="http://www.w3.org/2003/01/geo/",LODCOMPREFIX="http://vocab.lodcom.de/",DBPPREFIX="http://dbpedia.org/ontology/",GNPREFIX="http://www.geonames.org/ontology#",RDFPREFIX="http://www.w3.org/1999/02/22-rdf-syntax-ns#",OWLPREFIX="http://www.w3.org/2002/07/owl#",sparqlHTTPConnection={sparqlPOSTRequest:function(e,t){$.ajax({type:"POST",url:"http://giv-lodumdata.uni-muenster.de:8282/parliament/sparql",contentType:"application/x-www-form-urlencoded",data:e,success:function(e){t(e.results.bindings)},dataType:"json"})},createSparqlQuery:function(e){var t="";switch(e.type){case"panelQuery":var a="PREFIX lodcom:  <"+LODCOMPREFIX+">SELECT ?feature ?predicate ?object WHERE {GRAPH <http://course.introlinkeddata.org/G2> {?feature ?predicate ?object FILTER (?feature = lodcom:"+e.feature.properties.lodcomName+").}}";return a;case"geometryQuery":var r="PREFIX geo:<"+GEOSPARQLPREFIX+"> PREFIX dbp:<"+DBPPREFIX+"> PREFIX gn:<"+GNPREFIX+"> SELECT ?feature ?type ?area ?wkt ?name WHERE {GRAPH <http://course.introlinkeddata.org/G2> {?feature geo:hasGeometry ?b.?feature gn:name ?name.?b dbp:area ?area.?b geo:asWKT ?wkt.?feature a ?type.FILTER(?type = dbp:City || ?type = dbp:District || ?type = dbp:CityDistrict)}}";return r;case"main":case"entitled":var o="";switch(o="main"==e.type?"?feature lodcom:hasMainPopulation ?b.":"?feature lodcom:hasEntitledPopulation ?b.",e.feature.properties.administrativeLvl){case"CityDistrict":return t="PREFIX lodcom: <"+LODCOMPREFIX+">PREFIX rdf:<"+RDFPREFIX+">SELECT ?feature ?population ?year WHERE {GRAPH <http://course.introlinkeddata.org/G2> {FILTER (?feature = lodcom:"+e.feature.properties.lodcomName+")."+o+"?b lodcom:year ?year.?b rdf:value ?population}}";case"District":return t="PREFIX lodcom: <"+LODCOMPREFIX+">PREFIX gn:<"+GNPREFIX+">PREFIX rdf:<"+RDFPREFIX+">SELECT ?feature ?year ?population WHERE {GRAPH <http://course.introlinkeddata.org/G2> {?feature gn:parentFeature lodcom:"+e.feature.properties.lodcomName+"."+o+"?b lodcom:year ?year.?b rdf:value ?population}}";case"City":return t="PREFIX lodcom: <"+LODCOMPREFIX+">PREFIX gn:<"+GNPREFIX+">PREFIX rdf:<"+RDFPREFIX+">SELECT ?feature ?year ?population WHERE {GRAPH <http://course.introlinkeddata.org/G2> {?pFeature gn:parentFeature lodcom:"+e.feature.properties.lodcomName+".?feature gn:parentFeature ?pFeature."+o+"?b lodcom:year ?year.?b rdf:value ?population}}";default:console.log("Admin lvl error")}break;case"female":case"male":case"gender":var l="";switch(l="female"==e.type?'FILTER (?gender = "female").':"male"==e.type?'FILTER (?gender = "male").':"",e.feature.properties.administrativeLvl){case"CityDistrict":return t="PREFIX lodcom:<"+LODCOMPREFIX+"> PREFIX rdf:<"+RDFPREFIX+">SELECT ?feature ?year ?gender ?value ?agegroup ?entitledPopulationValue WHERE { GRAPH <http://course.introlinkeddata.org/G2> {FILTER(?feature = lodcom:"+e.feature.properties.lodcomName+").?feature lodcom:hasGenderedPopulation ?genderedPopulation.?feature lodcom:hasEntitledPopulation ?entitledPopulation.?entitledPopulation lodcom:year ?entYear.?entitledPopulation rdf:value ?entitledPopulationValue.?genderedPopulation lodcom:year ?year.?genderedPopulation rdf:value ?value.?genderedPopulation lodcom:gender ?gender.?genderedPopulation lodcom:agegroup ?agegroup."+l+"FILTER (?entYear = ?year).}}ORDER BY ?year ?agegroup";case"District":return t="PREFIX lodcom:<"+LODCOMPREFIX+"> PREFIX gn:<"+GNPREFIX+">PREFIX rdf:<"+RDFPREFIX+">SELECT ?feature ?year ?gender ?value ?agegroup ?entitledPopulationValue WHERE { GRAPH <http://course.introlinkeddata.org/G2> {?feature gn:parentFeature ?parentFeature.FILTER(?parentFeature = lodcom:"+e.feature.properties.lodcomName+").?feature lodcom:hasGenderedPopulation ?genderedPopulation.?feature lodcom:hasEntitledPopulation ?entitledPopulation.?entitledPopulation lodcom:year ?entYear.?entitledPopulation rdf:value ?entitledPopulationValue.?genderedPopulation lodcom:year ?year.?genderedPopulation rdf:value ?value.?genderedPopulation lodcom:gender ?gender.?genderedPopulation lodcom:agegroup ?agegroup."+l+"FILTER (?entYear = ?year).}}ORDER BY ?year ?agegroup";case"City":return t="PREFIX lodcom:<"+LODCOMPREFIX+"> PREFIX gn:<"+GNPREFIX+">PREFIX rdf:<"+RDFPREFIX+">SELECT ?feature ?year ?gender ?value ?agegroup ?entitledPopulationValue WHERE { GRAPH <http://course.introlinkeddata.org/G2> {?parentFeature gn:parentFeature ?parent2Feature.?feature gn:parentFeature ?parentFeature.FILTER(?parent2Feature = lodcom:"+e.feature.properties.lodcomName+").?feature lodcom:hasGenderedPopulation ?genderedPopulation.?feature lodcom:hasEntitledPopulation ?entitledPopulation.?entitledPopulation lodcom:year ?entYear.?entitledPopulation rdf:value ?entitledPopulationValue.?genderedPopulation lodcom:year ?year.?genderedPopulation rdf:value ?value.?genderedPopulation lodcom:gender ?gender.?genderedPopulation lodcom:agegroup ?agegroup."+l+"FILTER (?entYear = ?year).}}ORDER BY ?year ?agegroup"}break;case"distinctPopulation":var o="";switch(e.populationType){case"main":o="?feature lodcom:hasMainPopulation ?b.";break;case"entitled":o="?feature lodcom:hasEntitledPopulation ?b.";break;case"gender":case"male":case"female":o="?feature lodcom:hasGenderedPopulation ?b.";break;default:console.log("Population type error")}return t="PREFIX lodcom: <"+LODCOMPREFIX+">SELECT DISTINCT ?year WHERE {GRAPH <http://course.introlinkeddata.org/G2> {"+o+"?b lodcom:year ?year.}}ORDER BY ?year";case"distinctAgeGroups":return t="PREFIX lodcom: <"+LODCOMPREFIX+">SELECT DISTINCT ?agegroup WHERE {GRAPH <http://course.introlinkeddata.org/G2> {?feature lodcom:hasGenderedPopulation ?pop.?pop lodcom:agegroup ?agegroup.}}ORDER BY ?agegroup";default:console.log("Something went wrong. the definition of the type might be false")}},getDataForPanel:function(e,t){var a={type:"panelQuery",feature:e},r={query:this.createSparqlQuery(a),display:"json",output:"json"};this.sparqlPOSTRequest(r,function(e){0!=e.length?t(e):(console.log("Error: getDataForPanel query failed"),t(null))})},getDataForFeature:function(e,t){var a={type:populationType,feature:e},r={query:this.createSparqlQuery(a),display:"json",output:"json"};this.sparqlPOSTRequest(r,function(a){var r={name:e.properties.name};if(0==a.length)return"no Data available";switch(populationType){case"main":case"entitled":switch(e.properties.administrativeLvl){case"CityDistrict":for(var o=0;o<a.length;o++){var l=a[o].year.value;void 0===r.population&&(r.population={}),r.population[l]=parseInt(a[o].population.value)}t(r);break;case"District":case"City":r.population={};for(var o=0;o<a.length;o++){var l=a[o].year.value;void 0===r.population[l]?r.population[l]=parseInt(a[o].population.value):r.population[l]+=parseInt(a[o].population.value)}t(r)}break;case"male":case"female":switch(e.properties.administrativeLvl){case"CityDistrict":for(var o=0;o<a.length;o++)void 0===r.population&&(r.population={}),void 0==r.population[a[o].year.value]&&(r.population[a[o].year.value]={}),r.population[a[o].year.value][a[o].agegroup.value]=parseInt(a[o].value.value);t(r);break;case"District":case"City":r.population={};for(var o=0;o<a.length;o++){var l=a[o].year.value;void 0===r.population[l]&&(r.population[l]={}),void 0===r.population[l][a[o].agegroup.value]?r.population[l][a[o].agegroup.value]=parseInt(a[o].value.value):r.population[l][a[o].agegroup.value]+=parseInt(a[o].value.value)}t(r)}break;case"gender":switch(e.properties.administrativeLvl){case"CityDistrict":for(var o=0;o<a.length;o++)void 0===r.population&&(r.population={}),void 0==r.population[a[o].gender.value]&&(r.population[a[o].gender.value]=[]),void 0==r.population[a[o].gender.value][a[o].year.value]&&(r.population[a[o].gender.value][a[o].year.value]={}),void 0==r.population[a[o].gender.value][a[o].year.value][a[o].agegroup.value]&&(r.population[a[o].gender.value][a[o].year.value][a[o].agegroup.value]=0),r.population[a[o].gender.value][a[o].year.value][a[o].agegroup.value]+=parseInt(a[o].value.value);t(r);break;case"District":case"City":console.log(a);for(var n=0,o=0;o<a.length;o++)void 0===r.population&&(r.population={}),void 0==r.population[a[o].gender.value]&&(r.population[a[o].gender.value]=[]),void 0==r.population[a[o].gender.value][a[o].year.value]&&(r.population[a[o].gender.value][a[o].year.value]={}),void 0==r.population[a[o].gender.value][a[o].year.value][a[o].agegroup.value]&&(r.population[a[o].gender.value][a[o].year.value][a[o].agegroup.value]=0),r.population[a[o].gender.value][a[o].year.value][a[o].agegroup.value]+=parseInt(a[o].value.value),n+=parseInt(a[o].value.value);console.log(r),t(r)}}})}},popup,comparingStatus=!1,populationType="main",selectedAgeGroup="",selectedYear="",timeSliderMovement=!1,selectedFeatures=[];$(document).ready(function(){function e(e,r){channelStyle(r,!0),r.on({click:function(){if(r.bringToFront(),comparingStatus)if(resetGeneralInformation(),addStatus){for(var t=!1,a=0;a<selectedFeatures.length;a++)r==selectedFeatures[a].layer&&(t=!0);if(!t){$("#chart").html('<br><center><i class="fa fa-spinner fa-pulse"></i></center>');var o=[],l=0;selectedFeatures.push({layer:r,feature:e});for(var a=0;a<selectedFeatures.length;a++)sparqlHTTPConnection.getDataForFeature(selectedFeatures[a].feature,function(e){l+=1,o.push(e),l==selectedFeatures.length&&changeHighcharts.setDiagram({type:populationType,features:o})})}}else{for(var t=!1,a=0;a<selectedFeatures.length;a++)r==selectedFeatures[a].layer&&(t=!0,selectedFeatures.splice(a,1));if(t){$("#chart").html('<br><center><i class="fa fa-spinner fa-pulse"></i></center>');for(var o=[],l=0,a=0;a<selectedFeatures.length;a++)sparqlHTTPConnection.getDataForFeature(selectedFeatures[a].feature,function(e){l+=1,o.push(e),l==selectedFeatures.length&&changeHighcharts.setDiagram({type:populationType,features:o})})}}else{$("#chart").html('<br><center><i class="fa fa-spinner fa-pulse"></i></center>'),sparqlHTTPConnection.getDataForFeature(e,function(e){changeHighcharts.setDiagram({type:populationType,features:[e]})}),sparqlHTTPConnection.getDataForPanel(e,function(t){setGeneralInformation(e,t)});for(var a=0;a<selectedFeatures.length;a++)channelStyle(selectedFeatures[a].layer,!1);selectedFeatures=[],selectedFeatures.push({layer:r,feature:e})}r.setStyle(clickedStyle())},mousemove:t,mouseout:a})}function t(e){if(!timeSliderMovement){var t=e.target;if(void 0!=t.feature.displayInformation[selectedYear]){if(popup.setLatLng(e.latlng),void 0!=t.feature.displayInformation)if("main"==populationType||"entitled"==populationType){var a=parseInt(t.feature.displayInformation[selectedYear].population/t.feature.properties.area);popup.setContent('<div class="marker-title">'+t.feature.properties.name+"</div>"+a+" "+language[getCookieObject().language].map.legend.title.mainPopulation)}else{var a=(t.feature.displayInformation[selectedYear][selectedAgeGroup].value/t.feature.displayInformation[selectedYear].population*100).toFixed(2);popup.setContent('<div class="marker-title">'+t.feature.properties.name+"</div>"+a+" "+language[getCookieObject().language].map.legend.title.percentPopulation)}else popup.setContent('<div class="marker-title">'+t.feature.properties.name+"</div>No data available");popup._map||popup.openOn(r),window.clearTimeout(d);for(var o=!1,l=0;l<selectedFeatures.length;l++)selectedFeatures[l].layer==t&&(o=!0);o||t.setStyle({weight:1,opacity:1,fillOpacity:.9})}}}function a(e){if(!timeSliderMovement){var t=e.target;if(0===selectedFeatures.length)channelStyle(t,!1);else{for(var a=!1,o=0;o<selectedFeatures.length;o++)t==selectedFeatures[o].layer&&(a=!0);a||channelStyle(t,!1)}d=window.setTimeout(function(){r.closePopup()},100)}}L.mapbox.accessToken=getMapboxAccessToken();var r=L.mapbox.map("map").setView([51.961298,7.625849],11);L.control.layers({Streets:L.mapbox.tileLayer("mapbox.streets").addTo(r),Satellite:L.mapbox.tileLayer("mapbox.satellite"),Light:L.mapbox.tileLayer("mapbox.light"),Dark:L.mapbox.tileLayer("mapbox.dark")}).addTo(r),setDiv("compareButton","map.compareButton.comparison"),appendDiv("compareButton","map.layerButton.city"),r.on("click",function(e){comparingStatus||(changeHighcharts.emptyHighCharts(),setStyleForNoSelectedFeatures(),resetGeneralInformation())});var o=L.featureGroup(),l=L.featureGroup(),n=L.featureGroup(),i=L.layerGroup([o]).addTo(r),p=L.layerGroup().addTo(r),u=L.layerGroup().addTo(r),s={query:sparqlHTTPConnection.createSparqlQuery({type:"geometryQuery"}),display:"json",output:"json"};createSliderControl(r,[o,l,n]),r.legendControl.addLegend(getLegendHTML()),popup=new L.Popup({autoPan:!1}),sparqlHTTPConnection.sparqlPOSTRequest(s,function(t){for(var a=0;a<t.length;a++){var r=t[a].wkt.value,i=Terraformer.WKT.parse(r),p=t[a].type.value;p=p.replace(DBPPREFIX,"");var u={geometry:i,type:"Feature",id:t[a].feature.value.replace(LODCOMPREFIX,""),properties:{name:t[a].name.value.replace(LODCOMPREFIX,""),lodcomName:t[a].feature.value.replace(LODCOMPREFIX,""),administrativeLvl:p,area:parseFloat(t[a].area.value)/1e6}};switch(p){case"City":o.addLayer(L.geoJson(u,{onEachFeature:e}));break;case"District":l.addLayer(L.geoJson(u,{onEachFeature:e}));break;case"CityDistrict":n.addLayer(L.geoJson(u,{onEachFeature:e}));break;default:console.log("something went wrong. The administrative connection could not be mapped")}}}),$("#level_1_button").click(function(){$("#general").html(""),$("#chart2").remove(),changeHighcharts.emptyHighCharts(),setStyleForNoSelectedFeatures(),selectedFeatures=[],i.clearLayers(),p.clearLayers(),u.clearLayers(),i.addLayer(o),setButtonStyle("#level_1_button","btn-default","btn-primary"),setButtonStyle("#level_2_button","btn-primary","btn-default"),setButtonStyle("#level_3_button","btn-primary","btn-default"),setDiv("compareButton","map.compareButton.comparison"),appendDiv("compareButton","map.layerButton.city")}),$("#level_2_button").click(function(){$("#general").html(""),$("#chart2").remove(),changeHighcharts.emptyHighCharts(),setStyleForNoSelectedFeatures(),selectedFeatures=[],i.clearLayers(),p.clearLayers(),u.clearLayers(),p.addLayer(l),setButtonStyle("#level_1_button","btn-primary","btn-default"),setButtonStyle("#level_2_button","btn-default","btn-primary"),setButtonStyle("#level_3_button","btn-primary","btn-default"),setDiv("compareButton","map.compareButton.comparison"),appendDiv("compareButton","map.layerButton.district")}),$("#level_3_button").click(function(){$("#general").html(""),$("#chart2").remove(),changeHighcharts.emptyHighCharts(),setStyleForNoSelectedFeatures(),selectedFeatures=[],i.clearLayers(),p.clearLayers(),u.clearLayers(),u.addLayer(n),setButtonStyle("#level_1_button","btn-primary","btn-default"),setButtonStyle("#level_2_button","btn-primary","btn-default"),setButtonStyle("#level_3_button","btn-default","btn-primary"),setDiv("compareButton","map.compareButton.comparison"),appendDiv("compareButton","map.layerButton.cityDistrict")});var d,c=[o,l,n];connectCompareButtonToMap(c),connectToPopulationTypeDropdownToLoadData(function(e){if(populationType=e,"gender"==populationType)$(".compare-buttons").children().prop("disabled",!0),selectedFeatures=selectedFeatures.slice(selectedFeatures.length-1,selectedFeatures.length),sparqlHTTPConnection.getDataForFeature(selectedFeatures[0].feature,function(e){changeHighcharts.setDiagram({type:populationType,features:[e]})});else{$(".compare-buttons").children().prop("disabled",!1);for(var t=0,a=[],o=0;o<selectedFeatures.length;o++)sparqlHTTPConnection.getDataForFeature(selectedFeatures[o].feature,function(e){t+=1,a.push(e),t==selectedFeatures.length&&changeHighcharts.setDiagram({type:populationType,features:a})})}changeStyleForAllLayers(c,!0),changeYearSliderControl(r,c),("male"==e||"female"==e||"gender"==e)&&connectAgeDropdownToMap(c),changeLegend()})}),$("#map").css.height=$(window).height()-50,$("#map").css("height",$(window).height()-50),$(window).on("resize",resize),resize(),$(document).ready(function(){changeHighcharts={setDiagram:function(e){if("main"==populationType||"entitled"==populationType){for(var t=[],a=[],r=0;r<e.features.length;r++)if(void 0!=e.features[r].population){a.push({name:e.features[r].name,data:[]});for(var o in e.features[r].population)a[a.length-1].data.push(e.features[r].population[o]),t.push(o)}0!=a.length?$("#chart").highcharts({chart:{type:"column"},title:{text:null},subtitle:{text:null},xAxis:{categories:t,crosshair:!0},yAxis:{min:0,title:{text:language[getCookieObject().language].map.panel.highCharts.yAxis}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:a,credits:{enabled:!1},exporting:{enabled:!1}}):$("#chart").html("Data missing")}else if("female"==populationType||"male"==populationType){for(var t=[],a=[],r=0;r<e.features.length;r++)if(void 0!=e.features[r].population){a.push({name:e.features[r].name,data:[]});for(var o in e.features[r].population)for(var l in e.features[r].population[o])a[a.length-1].data.push(e.features[r].population[o][l]),t.push(l)}0!=a.length?$("#chart").highcharts({chart:{type:"column"},title:{text:null},subtitle:{text:null},xAxis:{categories:t,crosshair:!0},yAxis:{min:0,title:{text:language[getCookieObject().language].map.panel.highCharts.yAxis}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y:}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:a,credits:{enabled:!1},exporting:{enabled:!1}}):$("#chart").html("Data missing")}else{$("#chart2").remove(),$("#chart").parent().append('<div class="chart" id="chart2"></div>');for(var n=[],i=[],p=[],u=[],r=0;r<e.features.length;r++)if(void 0!=e.features[r].population){var s=e.features[r].name;for(var d in e.features[r].population)if("female"==d){i.push({name:language[getCookieObject().language].map.panel.highCharts.gender.female,data:[]});for(var o in e.features[r].population[d])for(var l in e.features[r].population[d][o])i[i.length-1].data.push(e.features[r].population[d][o][l]),n.push(l)}else{u.push({name:language[getCookieObject().language].map.panel.highCharts.gender.male,data:[]});for(var o in e.features[r].population[d])for(var l in e.features[r].population[d][o])u[u.length-1].data.push(e.features[r].population[d][o][l]),p.push(l)}}0!=i.length?$("#chart").highcharts({chart:{type:"column"},title:{text:s+" "+selectedYear},subtitle:{text:null},xAxis:{categories:n,crosshair:!0},yAxis:{min:0,title:{text:language[getCookieObject().language].map.panel.highCharts.yAxis}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:i,credits:{enabled:!1},exporting:{enabled:!1}}):$("#chart").html("Data missing"),0!=u.length?$("#chart2").highcharts({chart:{type:"column"},title:{text:null},subtitle:{text:null},xAxis:{categories:p,crosshair:!0},yAxis:{min:0,title:{text:language[getCookieObject().language].map.panel.highCharts.yAxis}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:u,credits:{enabled:!1},exporting:{enabled:!1}}):$("#chart2").html("Data missing")}},emptyHighCharts:function(){$("#chart").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:language[getCookieObject().language].map.panel.highCharts.empty},series:[{type:"pie",name:"Random data",data:[]}],credits:{enabled:!1}}),$("#chart2").remove()}},changeHighcharts.emptyHighCharts()});